<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Interest Calculator</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="m-2">
    <form #formRef="ngForm" (ngSubmit)="onSubmit(formRef)">
      <div class="bgLight p-2 rounded mb-2">
        <div class="fs-5 fw-2 mb-1 mx-1">Enter details to calculate</div>
        <div class="form-floating mb-2">
          <input
            type="text"
            class="form-control"
            id="name"
            placeholder="name"
            name="clientName"
            [ngModel]="linkData.name"
            disabled
          />
          <label for="name"><span class="formLabel">Client name</span></label>
        </div>
        <div class="mb-2 d-flex justify-content-between">
          <div class="form-floating d-inline-block">
            <input
              type="number"
              class="form-control"
              id="principal"
              placeholder="100000"
              #principal="ngModel"
              name="principal"
              [(ngModel)]="linkData.principal"
              required
              [class.is-valid]="principal.valid"
              [class.is-invalid]="principal.invalid &&  formRef.submitted"
            />
            <label for="principal"
              ><span class="formLabel">Principal</span></label
            >
            <div id="principal" class="invalid-feedback">
              Please enter Principal amount.
            </div>
          </div>

          <div class="form-floating d-inline-block">
            <input
              type="number"
              class="form-control"
              id="interest"
              placeholder="1.50"
              [(ngModel)]="linkData.interest"
              name="interest"
              #interest="ngModel"
              required
              [class.is-valid]="interest.valid"
              [class.is-invalid]="interest.invalid &&  formRef.submitted"
            />
            <label for="interest"
              ><span class="formLabel">Interest rate</span></label
            >
            <div id="interest" class="invalid-feedback">
              Please enter interest value.
            </div>
          </div>
        </div>
        <div class="form-floating mb-2">
          <input
            type="date"
            class="form-control"
            id="startDate"
            [(ngModel)]="linkData.startDate"
            name="startDate"
            required
            #startDate="ngModel"
            [class.is-valid]="startDate.valid"
            [class.is-invalid]="startDate.invalid &&  formRef.submitted"
          />
          <label for="startDate"
            ><span class="formLabel">Start date</span></label
          >
          <div id="startDate" class="invalid-feedback">
            Please enter start Date.
          </div>
        </div>
        <div class="form-floating mb-1">
          <input
            type="date"
            class="form-control"
            id="endDate"
            [(ngModel)]="linkData.endDate"
            name="endDate"
            required
            #endDate="ngModel"
            [class.is-valid]="endDate.valid"
            [class.is-invalid]="endDate.invalid &&  formRef.submitted"
          />
          <label for="endDate"><span class="formLabel">End date</span></label>
          <div id="endDate" class="invalid-feedback">
            Please enter end Date.
          </div>
        </div>
      </div>

      <div
        *ngIf="linkData?.closedOn"
        class="bg-success rounded-3 text-light text-center"
      >
        <div class="p-2">
          Record closed on
          <span class="fw-bold"
            >{{linkData?.closedOn.split('-').reverse().join('/')}}</span
          ><br />
          with amount
          <span class="fw-bold">â‚¹ {{linkData?.closedAmount}}</span>
        </div>
      </div>

      <div class="mt-2 mb-3">
        <ion-button color="warning" expand="block" type="submit">
          Calculate
        </ion-button>
      </div>

      <div class="mb-3">
        <ion-button
          type="button"
          color="danger"
          expand="block"
          (click)="resetForm(formRef)"
        >
          Reset
        </ion-button>
      </div>
    </form>
  </div>

  <div class="rounded m-2 fw-bolder" *ngIf="showCalculatedData">
    <div class="fs-5 bg-success py-2 px-3 rounded-top text-light">
      Calculated Data
    </div>
    <div class="bgLight px-2 py-1 rounded-bottom" style="font-size: 95%">
      <ion-grid>
        <ion-row>
          <ion-col size="5"> Name </ion-col>
          <ion-col size="1">:</ion-col>
          <ion-col size="6">{{linkData.name}}</ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="5"> Principal (P) </ion-col>
          <ion-col size="1">:</ion-col>
          <ion-col size="6" class="highlight"
            >{{currencyFormat(linkData.principal)}}</ion-col
          >
        </ion-row>
        <ion-row>
          <ion-col size="5"> Int. rate (R) </ion-col>
          <ion-col size="1">:</ion-col>
          <ion-col size="6" class="highlight">{{linkData.interest}}</ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="5"> End Date </ion-col>
          <ion-col size="1">:</ion-col>
          <ion-col size="6">{{linkData.endDate}}</ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="5"> Start Date </ion-col>
          <ion-col size="1">:</ion-col>
          <ion-col size="6">
            <u style="text-underline-offset: 5px; text-decoration-color: green">
              {{linkData.startDate}}
            </u>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="5"> Time Period </ion-col>
          <ion-col size="1">:</ion-col>
          <ion-col size="6" class="highlight">
            <u style="text-underline-offset: 5px">
              {{timePeriodObject?.y}}y&nbsp; {{timePeriodObject?.m}}m&nbsp;
              {{timePeriodObject?.d}}d&nbsp;
            </u>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col class="text-center my-1">
            <div>
              T = 12x{{timePeriodObject?.y}} + {{timePeriodObject?.m}} +
              {{timePeriodObject?.d}}/30 = {{timePeriodObject.tm.toFixed(2)}} m
            </div>
            <div>
              I = {{linkData.principal}} x {{timePeriodObject.tm
              >36?36:timePeriodObject.tm.toFixed(3)}} x
              {{linkData.interest}}/100
            </div>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="5">
            Interest (I)
            <span
              *ngIf="advIntShow"
              style="font-size: smaller"
              class="highlight"
              >(3y)</span
            >
          </ion-col>
          <ion-col size="1">:</ion-col>
          <ion-col sizez="6" class="highlight"
            >{{currencyFormat(interestObj?.interest)}}</ion-col
          >
        </ion-row>
        <ion-row>
          <ion-col size="5"> Total amount </ion-col>
          <ion-col size="1">:</ion-col>
          <ion-col sizez="6" class="highlight">
            {{currencyFormat(interestObj?.interest+ linkData?.principal)}}
          </ion-col>
        </ion-row>
        <div *ngIf="advIntShow">
          <ion-row>
            <ion-col class="text-center text-light bg-danger rounded p-1 my-1">
              Time taken greater than 3 years
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="5">New principal</ion-col>
            <ion-col size="1">:</ion-col>
            <ion-col size="6">
              {{currencyFormat(interestObj?.newPrincipal)}}
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="5">Pending time</ion-col>
            <ion-col size="1">:</ion-col>
            <ion-col size="6">
              {{timePeriodObject?.y - 3}}y, {{timePeriodObject?.m}}m,
              {{timePeriodObject?.d}}d
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="5">New Interest</ion-col>
            <ion-col size="1">:</ion-col>
            <ion-col size="6" class="highlight">
              {{currencyFormat(interestObj?.newInterest)}}
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="5">Final amount</ion-col>
            <ion-col size="1">:</ion-col>
            <ion-col size="6" class="highlight">
              {{currencyFormat(interestObj?.newPrincipal+interestObj?.newInterest)}}
            </ion-col>
          </ion-row>
        </div>
      </ion-grid>
    </div>
  </div>
</ion-content>
